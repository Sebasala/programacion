---
import FormattedDate from "../components/FormattedDate.astro";
import { BASE_URL, CHANNELS } from "@src/consts";
import BaseLayout from "@layouts/BaseLayout.astro";
import ShareButton from "@components/ShareButton.astro";

const {
	blogPath,
	description,
	headerText,
	heroImage,
	ogImage,
	pubDate,
	slug,
	subtitle,
	title,
	updatedDate,
} = Astro.props;

const domain = Astro.site;

const articleUrl = `${domain?.origin}${blogPath}/${slug}/`;
const articleSource = "shan.lat";
const channelsKeys = Object.keys(CHANNELS);
---

<BaseLayout
	blogPath={blogPath}
	description={description}
	headerText={headerText}
	image={ogImage}
	title={title}
	withHeader
>
	<main>
		<!-- TODO: Divide this into smaller components -->
		<article>
			{
				heroImage && (
					<img
						class="hero-image"
						width={1020}
						height={510}
						src={`${BASE_URL}${heroImage}`}
						alt=""
					/>
				)
			}
			<section class="content">
				<div class="title text">
					<p class="date">
						<FormattedDate date={pubDate} />
						{
							updatedDate && (
								<div class="last-updated-on">
									Last updated on <FormattedDate date={updatedDate} />
								</div>
							)
						}
					</p>
					<h1 class="post-title">
						{title}
						<span class="subtitle">{subtitle}</span>
					</h1>
				</div>
				<div class="share">
					<p class="label">Comparte:</p>
					{
						channelsKeys.map((channel) => (
							<ShareButton
								channel={channel}
								articleSource={articleSource}
								articleUrl={articleUrl}
								description={description}
								title={title}
							/>
						))
					}
				</div>
				<div class="text">
					<slot />
				</div>
			</section>
		</article>
	</main>
</BaseLayout>
<style>
	.share {
		align-items: center;
		backdrop-filter: blur(5px);
		background-color: var(--translucid-light-background);
		border-radius: calc(2 * var(--space));
		display: flex;
		flex-flow: row nowrap;
		margin: calc(var(--space) / 2) auto;
		max-width: var(--share-container-max-width);
		padding: calc(var(--space) / 2);
		position: sticky;
		top: 0;
		width: max-content;
		z-index: 1;
	}
	.date,
	.label {
		border-radius: calc(var(--space) / 2);
		max-width: calc(7 * var(--space));
	}

	.date {
		backdrop-filter: blur(5px);
		margin: calc(var(--space) / 2) auto;
	}

	.label {
		font-weight: 700;
		margin: 0 calc(var(--space) / 2) 0 0;
	}

	.hero-image {
		border-radius: calc(4 * var(--space));
		margin: 0 auto calc(-11 * var(--space));
		max-height: calc(21 * var(--space));
		width: auto;
	}

	.text {
		margin: 0 auto;
	}

	.title {
		background-image: linear-gradient(
			180deg,
			rgba(100%, 100%, 100%, 0) 0%,
			var(--light-background) 100%
		);
		display: flex;
		flex-flow: column;
		justify-content: end;
		min-height: calc(11 * var(--space));
		padding-top: calc(2 * var(--space));
		position: relative;
	}
	.date {
		text-align: center;
	}

	@media screen and (min-width: 900px) {
		.content {
			max-width: 1000px;
		}

		.share {
			background-color: transparent;
			flex-flow: column nowrap;
			margin: calc(-10 * var(--space)) 0 calc(1 * var(--space)) auto;
		}

		.label {
			margin: 0 0 calc(var(--space) / 2);
		}
	}
</style>
